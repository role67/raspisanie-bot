from datetime import datetime, time

# –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞
MONDAY_SCHEDULE = {
    "–∫–ª–∞—Å—Å–Ω—ã–π —á–∞—Å 1": {"start": "08:30", "end": "09:15", "name": "–ö–ª–∞—Å—Å–Ω—ã–π —á–∞—Å - —Ä–∞–∑–≥–æ–≤–æ—Ä—ã –æ –≤–∞–∂–Ω–æ–º / –†–æ—Å—Å–∏—è - –º–æ–∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç—ã"},
    "–∫–ª–∞—Å—Å–Ω—ã–π —á–∞—Å 2": {"start": "09:15", "end": "10:00", "name": "–û–±—â–∏–π –∫–ª–∞—Å—Å–Ω—ã–π —á–∞—Å –≤ –≥—Ä—É–ø–ø–µ"},
    "1 –ø–∞—Ä–∞ 1": {"start": "10:20", "end": "11:05", "name": "1 –ø–∞—Ä–∞ (–ø–µ—Ä–≤–∞—è —á–∞—Å—Ç—å)"},
    "1 –ø–∞—Ä–∞ 2": {"start": "11:20", "end": "12:05", "name": "1 –ø–∞—Ä–∞ (–≤—Ç–æ—Ä–∞—è —á–∞—Å—Ç—å)"},
    "2 –ø–∞—Ä–∞ 1": {"start": "12:30", "end": "13:15", "name": "2 –ø–∞—Ä–∞ (–ø–µ—Ä–≤–∞—è —á–∞—Å—Ç—å)"},
    "2 –ø–∞—Ä–∞ 2": {"start": "13:30", "end": "14:15", "name": "2 –ø–∞—Ä–∞ (–≤—Ç–æ—Ä–∞—è —á–∞—Å—Ç—å)"},
    "3 –ø–∞—Ä–∞": {"start": "14:30", "end": "16:00", "name": "3 –ø–∞—Ä–∞"}
}

# –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Å–æ –≤—Ç–æ—Ä–Ω–∏–∫–∞ –ø–æ –ø—è—Ç–Ω–∏—Ü—É
WEEKDAY_SCHEDULE = {
    "1 –ø–∞—Ä–∞": {"start": "08:30", "end": "10:00", "name": "1 –ø–∞—Ä–∞"},
    "2 –ø–∞—Ä–∞ 1": {"start": "10:20", "end": "11:05", "name": "2 –ø–∞—Ä–∞ (–ø–µ—Ä–≤–∞—è —á–∞—Å—Ç—å)"},
    "2 –ø–∞—Ä–∞ 2": {"start": "11:20", "end": "12:05", "name": "2 –ø–∞—Ä–∞ (–≤—Ç–æ—Ä–∞—è —á–∞—Å—Ç—å)"},
    "3 –ø–∞—Ä–∞ 1": {"start": "12:30", "end": "13:15", "name": "3 –ø–∞—Ä–∞ (–ø–µ—Ä–≤–∞—è —á–∞—Å—Ç—å)"},
    "3 –ø–∞—Ä–∞ 2": {"start": "13:30", "end": "14:15", "name": "3 –ø–∞—Ä–∞ (–≤—Ç–æ—Ä–∞—è —á–∞—Å—Ç—å)"},
    "4 –ø–∞—Ä–∞": {"start": "14:30", "end": "16:00", "name": "4 –ø–∞—Ä–∞"}
}

# –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è —Å—É–±–±–æ—Ç—ã
SATURDAY_SCHEDULE = {
    "1 –ø–∞—Ä–∞": {"start": "08:30", "end": "10:00", "name": "1 –ø–∞—Ä–∞"},
    "2 –ø–∞—Ä–∞": {"start": "10:20", "end": "11:50", "name": "2 –ø–∞—Ä–∞"},
    "3 –ø–∞—Ä–∞": {"start": "12:10", "end": "13:40", "name": "3 –ø–∞—Ä–∞"}
}

def get_current_lesson_info():
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–π –ø–∞—Ä–µ –∏ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ —Å–ª–µ–¥—É—é—â–µ–π"""
    now = datetime.now()
    current_time = now.time()
    weekday = now.weekday()  # 0 = –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 6 = –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ

    # –í—ã–±–∏—Ä–∞–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–Ω—è –Ω–µ–¥–µ–ª–∏
    if weekday == 0:  # –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫
        schedule = MONDAY_SCHEDULE
    elif weekday == 5:  # –°—É–±–±–æ—Ç–∞
        schedule = SATURDAY_SCHEDULE
    elif weekday < 5:  # –í—Ç–æ—Ä–Ω–∏–∫-–ø—è—Ç–Ω–∏—Ü–∞
        schedule = WEEKDAY_SCHEDULE
    else:  # –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ
        return "üéâ –°–µ–≥–æ–¥–Ω—è –≤—ã—Ö–æ–¥–Ω–æ–π! –ó–∞–Ω—è—Ç–∏—è –Ω–∞—á–Ω—É—Ç—Å—è –∑–∞–≤—Ç—Ä–∞ –≤ 08:30"

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â—É—é –ø–∞—Ä—É
    for lesson, times in schedule.items():
        start_time = datetime.strptime(times['start'], "%H:%M").time()
        end_time = datetime.strptime(times['end'], "%H:%M").time()
        
        if start_time <= current_time <= end_time:
            minutes_left = (datetime.combine(now.date(), end_time) - 
                          datetime.combine(now.date(), current_time)).seconds // 60
            return (f"üìö –°–µ–π—á–∞—Å –∏–¥–µ—Ç: {times['name']}\n"
                   f"‚è∞ –ù–∞—á–∞–ª–æ: {times['start']}\n"
                   f"üîÑ –ö–æ–Ω–µ—Ü: {times['end']}\n"
                   f"‚åõÔ∏è –î–æ –∫–æ–Ω—Ü–∞ –ø–∞—Ä—ã: {minutes_left} –º–∏–Ω.")

    # –ò—â–µ–º —Å–ª–µ–¥—É—é—â—É—é –ø–∞—Ä—É
    next_lesson = None
    for lesson, times in schedule.items():
        start_time = datetime.strptime(times['start'], "%H:%M").time()
        if current_time < start_time:
            next_lesson = (times, start_time)
            break

    if next_lesson:
        times, start_time = next_lesson
        minutes_until = (datetime.combine(now.date(), start_time) - 
                        datetime.combine(now.date(), current_time)).seconds // 60
        return (f"üí§ –°–µ–π—á–∞—Å –ø–µ—Ä–µ—Ä—ã–≤\n"
               f"üìö –°–ª–µ–¥—É—é—â–∞—è –ø–∞—Ä–∞: {times['name']}\n"
               f"‚è∞ –ù–∞—á–∞–ª–æ —á–µ—Ä–µ–∑: {minutes_until} –º–∏–Ω. ({times['start']})")

    return "‚úÖ –ó–∞–Ω—è—Ç–∏—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å!"

def get_schedule_string(day_of_week=None):
    """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–≤–æ–Ω–∫–æ–≤ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –¥–Ω—è –Ω–µ–¥–µ–ª–∏"""
    if day_of_week == 0:  # –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫
        return ("üìÖ –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫:\n\n"
                "I –∫—É—Ä—Å:\n"
                "8:30 - 9:15 –∫–ª–∞—Å—Å–Ω—ã–π —á–∞—Å - —Ä–∞–∑–≥–æ–≤–æ—Ä—ã –æ –≤–∞–∂–Ω–æ–º\n"
                "9:15 - 10:00 –æ–±—â–∏–π –∫–ª–∞—Å—Å–Ω—ã–π —á–∞—Å –≤ –≥—Ä—É–ø–ø–µ\n\n"
                "II-III-IV –∫—É—Ä—Å—ã:\n"
                "8:30 - 9:15 –∫–ª–∞—Å—Å–Ω—ã–π —á–∞—Å - –†–æ—Å—Å–∏—è - –º–æ–∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç—ã\n"
                "9:15 - 10:00 –æ–±—â–∏–π –∫–ª–∞—Å—Å–Ω—ã–π —á–∞—Å –≤ –≥—Ä—É–ø–ø–µ\n\n"
                "1 –ø–∞—Ä–∞:\n10:20 - 11:05\n11:20 - 12:05\n"
                "2 –ø–∞—Ä–∞:\n12:30 - 13:15\n13:30 - 14:15\n"
                "3 –ø–∞—Ä–∞: 14:30 - 16:00")
    elif day_of_week == 5:  # –°—É–±–±–æ—Ç–∞
        return ("üìÖ –°—É–±–±–æ—Ç–∞:\n\n"
                "1 –ø–∞—Ä–∞: 8:30 - 10:00\n"
                "2 –ø–∞—Ä–∞: 10:20 - 11:50\n"
                "3 –ø–∞—Ä–∞: 12:10 - 13:40")
    elif day_of_week is None or 1 <= day_of_week <= 4:  # –í—Ç–æ—Ä–Ω–∏–∫-–ø—è—Ç–Ω–∏—Ü–∞
        return ("üìÖ –í—Ç–æ—Ä–Ω–∏–∫-–ü—è—Ç–Ω–∏—Ü–∞:\n\n"
                "1 –ø–∞—Ä–∞: 8:30 - 10:00\n"
                "2 –ø–∞—Ä–∞:\n10:20 - 11:05\n11:20 - 12:05\n"
                "3 –ø–∞—Ä–∞:\n12:30 - 13:15\n13:30 - 14:15\n"
                "4 –ø–∞—Ä–∞: 14:30 - 16:00")